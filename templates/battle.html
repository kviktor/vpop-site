<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Highcharts Example</title>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript">
$(function () {
        $('#container').highcharts({
            chart: {
                type: 'area',
                zoomType: 'x'
            },
            title: {
                text: ''
            },
            xAxis: {
                type: 'datetime',
                dateTimeLabelFormats: { // don't display the dummy year
                    month: '%e. %b',
                    year: '%b'
                },
                title: {
                    text: 'Date'
                }
            },
            yAxis: {
                title: {
                    text: 'Wall'
                },
                plotLines: [{
                  color: '#FF0000',
                  width: 2,
                  value: {{ battle.objectives.secure }},
                }]
            },
            tooltip: {
                headerFormat: '<b>{point.key}</b><br>',
                pointFormat: '{point.x:%H:%M} - Wall: {point.y:.0f}'
            },

            series: [{
                name: 'Wall',
                color: "#2868b0",
                negativeColor: "#c54743",
                threshold: {{ battle.objectives.secure }},
                turboThreshold: 0,
                data: [
                    {% for c in chart_data %}
                    {
                      'name': "{{ c.citizen }} {% if c.damage > 0%}+{% endif%}{{ c.damage }}",
                      'y': {{ c.wall }},
                      'x': Date.UTC({{c.time.year}}, {{c.time.month}}, {{c.time.day}},
                           {{c.time.hour}}, {{c.time.minute}}, {{c.time.second}}),
                    },
                    {% endfor %} 
                ]
            }]
        });
    });
    

    </script>
  </head>
  <body>
  <script src="/static/highcharts.js"></script>
  <script src="/static/exporting.js"></script>

  <h2> 
    {% if battle.is_resistance %}
      {{ battle.defender.name }} - {{ battle.region.name }} (RW)
    {% else %}
      {{ battle.attacker.name }} vs {{ battle.defender.name }} - {{ battle.region.name }}
    {% endif %}
    {% if not battle.is_active %}
      - Final wall: {{ battle.defence_points }}
    {% endif %}
  </h2>
  <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

  <h1>
    <p>
      Attacker side: {{ battle.att_side }} fights
    </p>
    <p>
      Defender side: {{ battle.def_side }} fights
    </p>

  <style>
    .highcharts-legend-item {display: none;}
  </style>
  </body>
</html>
